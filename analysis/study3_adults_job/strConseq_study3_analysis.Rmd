---
title             : "Consequences of a structural construal for normativity, possibility of change, intervention"
shorttitle        : "Structural consequences"

author: 
  - name          : "Marianna Y. Zhang"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Building 420, 450 Jane Stanford Way, Stanford, CA 94305"
    email         : "marianna.zhang@stanford.edu"

author: 
  - name          : "Ellen M. Markman"
    affiliation   : "1"
    corresponding : no
    address       : "Building 420, 450 Jane Stanford Way, Stanford, CA 94305"
    email         : "markman@stanford.edu"

affiliation:
  - id            : "1"
    institution   : "Stanford University"

authornote: |
Department of Psychology, Stanford University. Thanks to Aarthi Popat for coding the intervention open-ended responses in study one.

abstract: |

We notice that certain categories are more likely than other categories to exhibit particular properties. For instance, relative to other groups in the US, Black people are disproportionately infected by COVID-19, and disproportionately incarcerated. What do we make of such statistical patterns? Observing such group disparities might lead us to wonder "why?" and seek out causal structure. We can generate a loose taxonomy of these potential causal structures by the type of cause they primarily cite. For instance, a structural representation might consider "the cause" of a property to be a cause that is external to the category yet acts on members of the category. Why might a structural representation be different from other representations, and why would we care? Using data from adults and children, I suggest that a structural representation (as opposed to other representations) leads to importantly different beliefs about normativity (what should be the case), the possibility of change (would it be possible for the case to be otherwise), and targets of intervention (if we wanted the case to be otherwise, what should we change). 

<!-- https://tinyurl.com/ybremelq -->

keywords          : "structural thinking, categories, explanation, normativity, possibility of change"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa7"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
require("knitr")
#library("papaja")  # not available for R 4.0
library(here)       # setting directory

library(effsize)    # effect sizes for power analysis
library(effectsize) # effect sizes for power analysis
library(pwr)        # power analysis
library(BRRR)       # notify when done

library(psych)      # cohen's kappa for inter-rater reliability

library(MASS, exclude = "select")
library(multcomp)   # multiple pairwise comparisons
library(emmeans)    # multiple pairwise comparisons
library(brglm)      # logistic regression with Firth bias-reduction (when dealing with quasi-complete separation)
library(brms)       # Bayesian mixed effects model
library(tidybayes)  # Bayes factor
library(corrplot)   # correlation plots

library(tidyverse)  # tidying and wrangling data, visualizations
library(ggthemes)   # visualization themes for ggplot2
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r vis-theme, include = FALSE}
# Set visualization theme
theme_set(
  ggthemes::theme_few() +
    theme(text = element_text(size = 16), # large text size for presentation figures
          axis.ticks.x = element_blank()) # remove x-axis ticks
)

condition_colors = c("biological" = "#D9695F",
                     "cultural" = "#F2BF80",
                     "structural" = "#49808C")

intervention_colors = c("change group" = "#D9695F",
                        "change group biology" = "#D9695F",
                        "change group beliefs/culture" = "#F2BF80",
                        
                        "change structural context" = "#49808C",
                        "provide job training to group" = "#8F756A",
                        "create more jobs or access to jobs" = "#49808C",
                        
                        "change job wages, value, hours, work" = "#D5C7CE",
                        "other" = "#C3C7B6",
                        "ambiguous" = "#C3C7B6",
                        # "ambiguous" = "#D9D9D9",
                        "don't know" = "#9E9E9E")
```


# Methods
Methods description here

This project's [repository](https://github.com/mariannazhang/structural-consequences) and [preregistration]() can be found online.



## Participants

```{r import-data}
# Import data for analysis
data_raw <- read_csv(here("data", "strConseq_data_study3_coded.csv"))
```

```{r consent}
data <- data_raw %>%
  # Filter out those who didn't consent
  filter(consent == "I do consent to participate")
```


```{r clean-data}
data <- data %>% 
  # Filter out those who were assigned to wrong condition
  filter(condition != "biological_neg" & condition != "cultural_neg") %>% 
  
  # Add participant ID, coalesce redundant columns
  mutate(participant = row_number(),
         acceptability_fc = acceptability,
         acceptability = coalesce(acceptability_notOk, acceptability_ok),
         age = age_2_TEXT) %>% 
  
  # Keep columns we care about
  select(participant, 
         condition, 
         starts_with("check"),
         acceptability_fc, acceptability,
         diff,
         switched_context,
         expl_rate_1, expl_rate_2, expl_rate_3,
         intervention_coded, intervention_coded_1, intervention_coded_2,
         intervention_diff,
         age, gender:ses) %>% 
  
  # Renaming columns
  rename(expl_pref = expl_rate_1,
         expl_bestSuited = expl_rate_2,
         expl_constraint = expl_rate_3) %>% 
  
  # Recoding and cleaning
  mutate(condition = condition %>% 
           recode("biological_pos" = "biological",
                  "cultural_pos" = "cultural",
                  "structural" = "structural") %>% 
           factor(levels = c("biological",
                             "cultural",
                             "structural")),
         switched_context = switched_context %>% str_replace_all("\n", ""),
         acceptability = acceptability %>% recode("Very, very bad" = 1,
                                                  "Pretty bad" = 2,
                                                  "A little bad" = 3,
                                                  "A little good" = 4,
                                                  "Pretty good" = 5,
                                                  "Very, very good" = 6),
         diff = diff %>% recode("Very similar" = 1,
                                "Somewhat similar" = 2,
                                "Equally similar and different" = 3,
                                "Somewhat different" = 4,
                                "Very different" = 5),
         switched_context = switched_context %>% recode("For sure aquafruit farmer" = 1,
                                                        "Likely aquafruit farmer" = 2,
                                                        "Likely different job" = 3,
                                                        "For sure different job" = 4),
         expl_pref = expl_pref %>% recode("Not at all satisfying" = 1,
                                              "Slightly satisfying" = 2,
                                              "Somewhat satisfying" = 3,
                                              "Very satisfying" = 4,
                                              "Extremely satisfying" = 5),
         expl_bestSuited = expl_bestSuited %>% recode("Not at all satisfying" = 1,
                                              "Slightly satisfying" = 2,
                                              "Somewhat satisfying" = 3,
                                              "Very satisfying" = 4,
                                              "Extremely satisfying" = 5),
         expl_constraint = expl_constraint %>% recode("Not at all satisfying" = 1,
                                              "Slightly satisfying" = 2,
                                              "Somewhat satisfying" = 3,
                                              "Very satisfying" = 4,
                                              "Extremely satisfying" = 5),
         intervention_diff = intervention_diff %>% recode("Very easy" = 1,
                                                          "Somewhat easy" = 2,
                                                          "Somewhat difficult" = 3,
                                                          "Very difficult" = 4),
         education = education %>% factor(
           levels = c(
             "Less than high school",
             "High school/GED",
             "Some college",
             "Bachelor's (B.A., B.S.)",
             "Master's (M.A., M.S.)",
             "Doctoral (Ph.D., J.D., M.D.)",
             "Prefer not to specify")),
         ses = ses %>% factor(levels = c("Poor",
                                         "Working class",
                                         "Middle class",
                                         "Affluent",
                                         "Prefer not to specify")))
```



```{r exclude-sample-size}
# Record exclusions (participants may be counted twice)
sample <- data %>% 
  summarize(check_group = sum(check_group != "Zarpies,Vawns"),
            check_job = sum(check_job != "Aquafruit farmer,Distribution manager"), 
            check_task = sum(check_task != "Learning about Zarpies and answering questions about them"),
            n_collect = n())

# Exclude participants and remove exclusion columns
data <- data %>%
  filter(check_group == "Zarpies,Vawns" &
           check_job == "Aquafruit farmer,Distribution manager" &
           check_task == "Learning about Zarpies and answering questions about them") %>% 
  select(-starts_with("check"))

# Record number of participants in actual sample after exclusions, exclusion rate
sample <- sample %>%  
  mutate(n = nrow(data),
         n_excl = n_collect - n,
         excl_rate = n_excl/n_collect)

# Record number of participants in actual sample per condition
sample_condition <- data %>% 
  group_by(condition) %>% 
  summarize(n = length(unique(participant)))
```
We excluded `r sample$n_excl `participants (or `r sample$excl_rate` of all participants) based on pre-planned exclusion criteria.

After exclusions, we retained `r sample$n` participants: `r sample_condition$biological` in the biological condition, `r sample_condition$cultural` in the cultural condition, and `r sample_condition$structural` in the structural condition.

```{r dem}
# Record demographics of actual sample
## Age
dem_age <- data %>%
  mutate(age_bin = case_when(
           age < 18 ~ "<18",
           age > 17 & age <=24 ~ "18-24",
           age > 24 & age <=54 ~ "25-54",
           age > 55 & age <=64 ~ "55-64",
           age > 65 ~ "65+",
           TRUE ~ "NA")) %>% 
  count(age_bin) %>% 
  mutate(prop = n/sample$n)

## Gender
dem_gender <- data %>%
  count(gender, sort = TRUE) %>% 
  mutate(prop = n/sample$n)

## Race
dem_race <- data %>%
  count(race, sort = TRUE) %>% 
  mutate(prop = n/sample$n)

## Education
dem_education <- data %>%
  count(education) %>% 
  mutate(prop = n/sample$n)

## Socio-economic status (SES) 
dem_ses <- data %>%
  count(ses) %>% 
  mutate(prop = n/sample$n)

```


```{r intervention-reliability}
# Calculate inter-rater reliability for intervention coding: % agreement, and Cohen's kappa
data <- data %>%
  mutate(intervention_coded_same = (intervention_coded_1 == intervention_coded_2))

intervention_reliability <- data %>%
  summarize(percent_agreement =
              sum(intervention_coded_same) / length(intervention_coded_same))

intervention_reliability <- intervention_reliability %>%
  mutate(cohen_kappa = cohen.kappa(x = data %>%
                                     select(intervention_coded_1,
                                            intervention_coded_2) %>%
                                     as.data.frame())$kappa)

# Remove individual coder columns
data <- data %>%
  select(-intervention_coded_1, -intervention_coded_2)
```
Inter-rater reliability on coding intervention responses was moderate (`r intervention_reliability$percent_agreement` agreement, `r intervention_reliability$cohen_kappa` Cohen's kappa).
  
## Material

## Procedure



## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses. 

Participants were excluded for failing the attention checks.
<!-- data cleaning rules, data exclusion rules, covariates, etc. Key analysis of interest. Can also pre-specify additional analyses you plan to do.-->

```{r}
# Dummy variables for target of intervention codes
data_intervention <- data %>% 
  mutate(intervention_coded = intervention_coded %>% 
           str_replace_all(" ", "_") %>%
           str_replace_all("/", "_") %>%
           str_replace_all("'", "")) %>% 
  mutate(counts = 1) %>%
  spread(intervention_coded, counts, fill = 0)

# add group vs structure tag
data_intervention <- data_intervention %>% 
  mutate(target_group = change_group_biology + change_group_beliefs_culture,
         target_structure = provide_job_training_to_group + create_more_jobs_or_access_to_jobs)
```

```{r}
# Gather long data to tidy form, and rename
data_tidy <- data %>% 
  gather(measure, response, 
         c(acceptability_fc, acceptability,
           diff, 
           switched_context,
           expl_pref, expl_bestSuited, expl_constraint,
           intervention_coded, intervention_diff)) %>% 
  mutate(measure = measure %>% factor(levels = c("acceptability_fc", "acceptability",
                                                 "diff", 
                                                 "expl_pref", "expl_bestSuited", "expl_constraint",
                                                 "intervention_coded", "intervention_diff")))

# Split out open-ended text responses
data_tidy_intervention <- data_tidy %>% 
  filter(measure == "intervention_coded" | measure == "intervention_diff") %>% 
  spread(measure, response) %>% 
  mutate(intervention_coded = intervention_coded %>% 
           factor(levels = c("change group biology",
                             "change group beliefs/culture",
                             "provide job tools to group",
                             "provide job training to group",
                             "create more jobs or access to jobs", 
                             "change job wages, value, hours, work",
                             "change job conditions",
                             "other",
                             "ambiguous",
                             "don't know")),
         intervention_diff = intervention_diff %>% as.numeric())

# Split out forced choice responses
data_tidy_fc <- data_tidy %>% 
  filter(measure == "acceptability_fc") %>% 
  mutate(response = response %>% factor(levels = c("Okay",
                                                   "Not okay")))

# Remove those responses from data_tidy, and format responses as numeric
data_tidy <- data_tidy %>% 
  filter(measure != "intervention_coded" &
           measure != "acceptability_fc") %>% 
  mutate(response = response %>% as.numeric())
```


# Results
## Tables
```{r description}
# calculate means and sds by condition
summary_stats <- data %>% 
  group_by(condition) %>% 
  summarize(acceptability_mean = mean(acceptability, na.rm = TRUE),
            acceptability_sd = sd(acceptability, na.rm = TRUE),
            diff_mean = mean(diff, na.rm = TRUE),
            diff_sd = sd(diff, na.rm = TRUE),
            switched_context_mean = mean(switched_context, na.rm = TRUE),
            switched_context_sd = sd(switched_context, na.rm = TRUE),
            expl_pref_mean = mean(expl_pref, na.rm = TRUE),
            expl_pref_sd = sd(expl_pref, na.rm = TRUE),
            expl_bestSuited_mean = mean(expl_bestSuited, na.rm = TRUE),
            expl_bestSuited_sd = sd(expl_bestSuited, na.rm = TRUE),
            expl_constraint_mean = mean(expl_constraint, na.rm = TRUE),
            expl_constraint_sd = sd(expl_constraint, na.rm = TRUE))
summary_stats


# make contingency table of intervention responses
data_intervention_counts <- data_intervention %>% 
  group_by(condition) %>% 
  summarize(across(change_group_beliefs_culture:provide_job_training_to_group, 
                   sum))

```

## Analyses
### Acceptability
```{r}
# Plot responses: acceptability
ggplot(data, aes(x = condition, y = acceptability)) +
  # ggtitle("Acceptability") +
  scale_y_continuous(name = "",
                     # name = "attitudes towards current group disparity",
                     limits = c(0.9, 6.1),
                     breaks = c(1, 2, 3, 4, 5, 6),
                     labels = c("very, very bad", "pretty bad", "a little bad", "a little good", "pretty good", "very, very good")) +
  geom_hline(yintercept = mean(c(1, 2, 3, 4, 5, 6)), linetype = "dashed") +
  geom_point(position = position_jitter(width = 0.2, height = 0.1),
             size = 2, alpha = 0.1) + 
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5)
ggsave("acceptability.png", width = 7)

# blank
ggplot(data, aes(x = condition, y = acceptability)) +
  # ggtitle("Acceptability") +
  scale_y_continuous(name = "",
                     # name = "attitudes towards current group disparity",
                     limits = c(0.9, 6.1),
                     breaks = c(1, 2, 3, 4, 5, 6),
                     labels = c("very, very bad", "pretty bad", "a little bad", "a little good", "pretty good", "very, very good")) +
  scale_x_discrete(limits = c("biological", "cultural", "structural")) +
  geom_hline(yintercept = mean(c(1, 2, 3, 4, 5, 6)), linetype = "dashed")
ggsave("acceptability_blank.png", width = 7)

```

```{r acceptability-analysis}
# Acceptability: linear model, controlling for difficulty of intervention
acceptability_lm <- lm(acceptability ~ condition + intervention_diff,
                    data = data)

# main effect of condition, controlling for intervention difficulty
acceptability_lm %>% 
  aov() %>% 
  summary()

# compare all pairwise condition means (controlling for difficulty of intervention), FDR adjustment for all comparisons
acceptability_lm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "fdr") %>% 
  summary()

# compare conditions against chance
t.test(data %>% filter(condition == "biological") %>% select(acceptability),
       mu = mean(1:6))

t.test(data %>% filter(condition == "cultural") %>% select(acceptability),
       mu = mean(1:6))

t.test(data %>% filter(condition == "structural") %>% select(acceptability),
       mu = mean(1:6))
```



### Switched context
```{r}
# Plot responses: switched context
ggplot(data, aes(x = condition, y = switched_context)) +
  # ggtitle("Switched context",
  #         "born, raised, lives in a different island country") +
  scale_y_continuous(name = "",
                     # name = "a group member outside context",
                     limits = c(0.9, 4.1),
                     breaks = c(1:4),
                     labels = c("for sure aquafruit farmer", "probably aquafruit farmer", "probably diff job", "for sure diff job")) +
  geom_hline(yintercept = mean(1:4), linetype = "dashed") +
  geom_point(position = position_jitter(width = 0.2, height = 0.1),
             size = 2, alpha = 0.1) + 
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5)
ggsave("switched_context.png", width = 7)


# blank
ggplot(data, aes(x = condition, y = switched_context)) +
  # ggtitle("Switched context",
  #         "born, raised, lives in a different island country") +
  scale_y_continuous(name = "",
                     # name = "a group member outside context",
                     limits = c(0.9, 4.1),
                     breaks = c(1:4),
                     labels = c("for sure aquafruit farmer", "probably aquafruit farmer", "probably diff job", "for sure diff job")) +
  geom_hline(yintercept = mean(1:4), linetype = "dashed") +
  scale_x_discrete(limits = c("biological", "cultural", "structural"))
ggsave("switched_context_blank.png", width = 7)

```


```{r switched-context-analysis}
# switched context: linear model, controlling for difficulty of intervention
switched_context_lm <- lm(switched_context ~ condition + intervention_diff,
              data = data)

# main effect of condition, controlling for intervention difficulty
switched_context_lm %>% 
  aov() %>% 
  summary()

# compare all pairwise condition means (controlling for difficulty of intervention), FDR adjustment for all comparisons
switched_context_lm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "fdr") %>% 
  summary()

# compare conditions against chance
t.test(data %>% filter(condition == "biological") %>% select(switched_context),
       mu = mean(1:4))

t.test(data %>% filter(condition == "cultural") %>% select(switched_context),
       mu = mean(1:4))

t.test(data %>% filter(condition == "structural") %>% select(switched_context),
       mu = mean(1:4))
```

### Group differences
```{r group-diff}
# Plot responses: group differences
ggplot(data, aes(x = condition, y = diff)) +
  # ggtitle("Group differences") +
  scale_y_continuous(name = "",
                     # name = "Zarpies and Vawns are...",
                     limits = c(0.9, 5.1),
                     breaks = c(1, 2, 3, 4, 5),
                     labels = c("Very similar", "Somewhat similar", "Equally similar and different", "Somewhat different", "Very different")) +
  geom_hline(yintercept = mean(c(1, 2, 3, 4, 5)), linetype = "dashed") +
  geom_point(position = position_jitter(width = 0.2, height = 0.1),
             size = 2, alpha = 0.1) + 
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5)
ggsave("group_diff.png")

# Plot responses: group differences
ggplot(data, aes(x = condition, y = diff)) +
  # ggtitle("Group differences") +
  scale_y_continuous(name = "",
                     # name = "Zarpies and Vawns are...",
                     limits = c(0.9, 5.1),
                     breaks = c(1, 2, 3, 4, 5),
                     labels = c("Very similar", "Somewhat similar", "Equally similar and different", "Somewhat different", "Very different")) +
  geom_hline(yintercept = mean(c(1, 2, 3, 4, 5)), linetype = "dashed") +
  scale_x_discrete(limits = c("biological", "cultural", "structural"))
ggsave("group_diff_blank.png")

```


```{r group-diff-analysis}
# Group diff: linear model, controlling for difficulty of intervention
diff_lm <- lm(diff ~ condition + intervention_diff,
              data = data)

# main effect of condition, controlling for intervention difficulty
diff_lm %>% 
  aov() %>% 
  summary()

# compare all pairwise condition means (controlling for difficulty of intervention), FDR adjustment for all comparisons
diff_lm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "fdr") %>% 
  summary()

# compare conditions against chance
t.test(data %>% filter(condition == "biological") %>% select(diff),
       mu = mean(1:5))

t.test(data %>% filter(condition == "cultural") %>% select(diff),
       mu = mean(1:5))

t.test(data %>% filter(condition == "structural") %>% select(diff),
       mu = mean(1:5))
```


### Explanation ratings
```{r expl-pref}
# Plot responses: explanation ratings: preference
ggplot(data, aes(x = condition, y = expl_pref)) +
  # ggtitle("Rate: Zarpies prefer to work as aquafruit farmers.") +
  scale_y_continuous(name = "",
                     # name = "How satisfying?",
                     limits = c(0.9, 5.1),
                     breaks = c(1:5),
                     labels = c("Not at all", "Slightly", "Somewhat", "Very", "Extremely")) +
  geom_point(position = position_jitter(width = 0.2, height = 0.1),
             size = 2, alpha = 0.1) + 
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5)
ggsave("expl_pref.png")

```


```{r expl-pref-analysis}
# expl-pref: linear model, controlling for difficulty of intervention
expl_pref_lm <- lm(expl_pref ~ condition + intervention_diff,
                   data = data)

# main effect of condition, controlling for intervention difficulty
expl_pref_lm %>% 
  aov() %>% 
  summary()

# compare all pairwise condition means (controlling for difficulty of intervention), FDR adjustment for all comparisons
expl_pref_lm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "fdr") %>% 
  summary()

# compare conditions against chance
t.test(data %>% filter(condition == "biological") %>% select(expl_pref),
       mu = mean(1:5))

t.test(data %>% filter(condition == "cultural") %>% select(expl_pref),
       mu = mean(1:5))

t.test(data %>% filter(condition == "structural") %>% select(expl_pref),
       mu = mean(1:5))
```

```{r expl-bestSuited}
# Plot responses: explanation ratings: best suited
ggplot(data, aes(x = condition, y = expl_bestSuited)) +
  # ggtitle("Rate: Zarpies are best-suited to working as aquafruit farmers.") +
  scale_y_continuous(name = "",
                     # name = "How satisfying?",
                     limits = c(0.9, 5.1),
                     breaks = c(1:5),
                     labels = c("Not at all", "Slightly", "Somewhat", "Very", "Extremely")) +
  geom_point(position = position_jitter(width = 0.2, height = 0.1),
             size = 2, alpha = 0.1) + 
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5)
ggsave("expl_bestSuited.png")

```


```{r expl-pref-analysis}
# expl-pref: linear model, controlling for difficulty of intervention
expl_bestSuited_lm <- lm(expl_bestSuited ~ condition + intervention_diff,
                   data = data)

# main effect of condition, controlling for intervention difficulty
expl_bestSuited_lm %>% 
  aov() %>% 
  summary()

# compare all pairwise condition means (controlling for difficulty of intervention), FDR adjustment for all comparisons
expl_bestSuited_lm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "fdr") %>% 
  summary()

# compare conditions against chance
t.test(data %>% filter(condition == "biological") %>% select(expl_bestSuited),
       mu = mean(1:5))

t.test(data %>% filter(condition == "cultural") %>% select(expl_bestSuited),
       mu = mean(1:5))

t.test(data %>% filter(condition == "structural") %>% select(expl_bestSuited),
       mu = mean(1:5))
```

```{r expl-constraint}
# Plot responses: explanation ratings: constraint
ggplot(data, aes(x = condition, y = expl_constraint)) +
  # ggtitle("Rate: Zarpies have few other options than to be aquafruit farmers.") +
  scale_y_continuous(name = "",
                     # name = "How satisfying?",
                     limits = c(0.9, 5.1),
                     breaks = c(1:5),
                     labels = c("Not at all", "Slightly", "Somewhat", "Very", "Extremely")) +
  geom_point(position = position_jitter(width = 0.2, height = 0.1),
             size = 2, alpha = 0.1) + 
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5)
ggsave("expl_constraint.png")

```

```{r expl-constraint-analysis}
# expl-constraint: linear model, controlling for difficulty of intervention
expl_constraint_lm <- lm(expl_constraint ~ condition + intervention_diff,
                   data = data)

# main effect of condition, controlling for intervention difficulty
expl_constraint_lm %>% 
  aov() %>% 
  summary()

# # compare all pairwise condition means (controlling for difficulty of intervention), FDR adjustment for all comparisons
# expl_constraint_lm %>% 
#   emmeans("condition") %>% 
#   pairs(adjust = "fdr") %>% 
#   summary()

# compare conditions against chance
t.test(data %>% filter(condition == "biological") %>% select(expl_constraint),
       mu = mean(1:5))

t.test(data %>% filter(condition == "cultural") %>% select(expl_constraint),
       mu = mean(1:5))

t.test(data %>% filter(condition == "structural") %>% select(expl_constraint),
       mu = mean(1:5))
```


### Target of intervention
```{r target-of-intervention}
# Plot: target of intervention
ggplot(data_tidy_intervention, 
       aes(x = condition, fill = intervention_coded)) +
  # ggtitle("Target of intervention") +
  geom_bar(position = "fill") +
  scale_fill_manual(values = intervention_colors) +
  guides(fill = guide_legend(title = NULL)) +
  scale_y_continuous(name = "",
                     # name = "What would you do, so that \n Zarpies can work as distribution managers?",
                     labels = scales::percent,
                     expand = c(0,0)) +
  scale_x_discrete(expand = c(0,0))
ggsave("intervention.png", width = 10)

# Plot: target of intervention
ggplot(data_tidy_intervention, 
       aes(x = condition, fill = intervention_coded)) +
  # ggtitle("Target of intervention") +
  geom_bar(position = "fill") +
  scale_fill_manual(values = intervention_colors) +
  guides(fill = guide_legend(title = NULL)) +
  scale_y_continuous(name = "",
                     # name = "What would you do, so that \n Zarpies can work as distribution managers?",
                     labels = scales::percent,
                     expand = c(0,0)) +
  scale_x_discrete(expand = c(0,0))
ggsave("intervention_grouped.png", width = 10)

```

```{r intervention-initial}
# Analyze whether counts of coded responses are independent of condition, using Fisher's exact test (rather than chi-square because of small sample size).
# Fisher's exact test: are the proportion of responses different across the 3 conditions?
fisher.test(data_intervention_counts %>% 
              dplyr::select(-condition), workspace = 2e8)
```

```{r intervention-change_group_beliefs_culture}
# Target of intervention: change group beliefs/culture: logistic regression, controlling for difficulty of intervention 
glm(change_group_beliefs_culture ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention) %>% 
  summary()
```
If observe quasi-complete separation in the logistic regression for the internalist_cultural condition, implement logistic regression with Firth bias-reduction. Otherwise proceed with glm.

```{r intervention-change_group_beliefs_culture-2, warning=FALSE}
change_group_beliefs_culture_glm <- brglm(change_group_beliefs_culture ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention)

# ANOVA for main effect of condition, controlling for intervention difficulty?
change_group_beliefs_culture_glm %>%
  aov() %>%
  summary()

# simultaneous pairwise comparisons (condition 1v2, 2v3, 1v3), adjusted
change_group_beliefs_culture_glm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "FDR") %>% 
  summary()
```

```{r intervention-create_more_jobs_or_access_to_jobs}
# Target of intervention: create_more_jobs_or_access_to_jobs: logistic regression, controlling for difficulty of intervention 
glm(create_more_jobs_or_access_to_jobs ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention) %>% 
  summary()
```
If observe quasi-complete separation in the logistic regression for the internalist_cultural condition, implement logistic regression with Firth bias-reduction. Otherwise proceed with glm.

```{r intervention-create_more_jobs_or_access_to_jobs-2, warning=FALSE}
create_more_jobs_or_access_to_jobs_glm <- glm(create_more_jobs_or_access_to_jobs ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention)

# ANOVA for main effect of condition, controlling for intervention difficulty?
create_more_jobs_or_access_to_jobs_glm %>%
  aov() %>%
  summary()

# simultaneous pairwise comparisons (condition 1v2, 2v3, 1v3), adjusted
create_more_jobs_or_access_to_jobs_glm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "FDR") %>% 
  summary()

# odds ratios?
exp(cbind(coef(create_more_jobs_or_access_to_jobs_glm), confint(create_more_jobs_or_access_to_jobs_glm))) 
```

```{r intervention-provide_job_training_to_group}
# Target of intervention: provide_job_training_to_group: logistic regression, controlling for difficulty of intervention 
glm(provide_job_training_to_group ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention) %>% 
  summary()
```
If observe quasi-complete separation in the logistic regression for the internalist_cultural condition, implement logistic regression with Firth bias-reduction. Otherwise proceed with glm.

```{r intervention-provide_job_training_to_group-2, warning=FALSE}
provide_job_training_to_group_glm <- glm(provide_job_training_to_group ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention)

# ANOVA for main effect of condition, controlling for intervention difficulty?
provide_job_training_to_group_glm %>%
  aov() %>%
  summary()

# simultaneous pairwise comparisons (condition 1v2, 2v3, 1v3), adjusted
provide_job_training_to_group_glm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "FDR") %>% 
  summary()
```

Group-based vs structure-based interventions:


```{r}
# Target of intervention: target_group: logistic regression, controlling for difficulty of intervention 
glm(target_group ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention) %>% 
  summary()
```
If observe quasi-complete separation in the logistic regression for the internalist_cultural condition, implement logistic regression with Firth bias-reduction. Otherwise proceed with glm.

```{r intervention-target_group-2, warning=FALSE}
target_group_glm <- glm(target_group ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention)

# ANOVA for main effect of condition, controlling for intervention difficulty?
target_group_glm %>%
  aov() %>%
  summary()

# simultaneous pairwise comparisons (condition 1v2, 2v3, 1v3), adjusted
target_group_glm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "FDR") %>% 
  summary()
```


```{r}
# Target of intervention: target_structure: logistic regression, controlling for difficulty of intervention 
glm(target_structure ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention) %>% 
  summary()
```
If observe quasi-complete separation in the logistic regression for the internalist_cultural condition, implement logistic regression with Firth bias-reduction. Otherwise proceed with glm.

```{r intervention-target_structure-2, warning=FALSE}
target_structure_glm <- glm(target_structure ~ condition + intervention_diff,
    family = "binomial",
    data = data_intervention)

# ANOVA for main effect of condition, controlling for intervention difficulty?
target_structure_glm %>%
  aov() %>%
  summary()

# simultaneous pairwise comparisons (condition 1v2, 2v3, 1v3), adjusted
target_structure_glm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "FDR") %>% 
  summary()
```



### Difficulty of intervention
```{r diff}
# Plot: difficulty of intervention by condition
ggplot(data_tidy_intervention, 
       aes(x = condition, y = intervention_diff, color = intervention_coded)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5) +
  guides(fill = guide_legend(title = NULL)) +
  scale_y_continuous(name = "How difficult would it be?",
                     labels = c("Very easy: 1", "Somewhat easy: 2", "Somewhat difficult: 3", "Very difficult: 4")) +
  ggtitle("Difficulty of intervention by condition") 
ggsave("intervention_diff_condition.png", width = 10)


# Plot: difficulty of intervention by intervention type
ggplot(data_tidy_intervention, 
       aes(x = intervention_coded, y = intervention_diff, color = condition)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.3) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5) +
  scale_color_manual(values = condition_colors) +
  scale_x_discrete(name = "Target of intervention") +
  scale_y_continuous(name = "How difficult would it be?",
                     labels = c("Very easy: 1", "Somewhat easy: 2", "Somewhat difficult: 3", "Very difficult: 4")) +
  ggtitle("Difficulty of intervention by target of intervention") 
ggsave("intervention_diff.png", width = 18)
```


```{r intervention-diff-analysis}
# intervention_diff: linear model
intervention_diff_lm <- lm(intervention_diff ~ condition,
                           data = data)

# main effect of condition
intervention_diff_lm %>% 
  aov() %>% 
  summary()

# compare all pairwise condition means, FDR adjustment for all comparisons
intervention_diff_lm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "fdr") %>% 
  summary()

```
## Exploratory
```{r }
ggplot(data, 
       aes(x = switched_context, y = acceptability)) +
  facet_wrap(vars(condition)) +
  geom_point(position = position_jitter(width = 0.1, height = 0.1),
             size = 2, alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE, level = 0.95) +
  scale_y_continuous(name = "attitudes towards present group disparity",
                     # name = "",
                     limits = c(0.9, 6.1),
                     breaks = c(1, 2, 3, 4, 5, 6),
                     labels = c("very, very bad", "pretty bad", "a little bad", "a little good", "pretty good", "very, very good")) +
  scale_x_continuous(name = "generalization to switched context",
                     # name = "Prediction about member outside context",
                     breaks = c(1, 2, 3, 4),
                     labels = c("for sure aquafruit farmer", "", "", "for sure diff job")) 
ggsave("switched_context_acceptability.png", width = 12)

```

# Discussion


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
