---
title             : "Consequences of a structural construal for normativity, possibility of change, intervention"
shorttitle        : "Structural consequences"

author: 
  - name          : "Marianna Y. Zhang"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Building 420, 450 Jane Stanford Way, Stanford, CA 94305"
    email         : "marianna.zhang@stanford.edu"

author: 
  - name          : "Ellen M. Markman"
    affiliation   : "1"
    corresponding : no
    address       : "Building 420, 450 Jane Stanford Way, Stanford, CA 94305"
    email         : "markman@stanford.edu"

affiliation:
  - id            : "1"
    institution   : "Stanford University"

authornote: |
  Department of Psychology, Stanford University

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  
  One or two sentences to put the results into a more **general context**.
  
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "structural thinking, categories, explanation, normativity, possibility of change"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa7"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
require("knitr")
#library("papaja")  # not available for R 4.0
library(here)       # setting directory

library(psych)      # for Cohen's kappa for interrater reliability
library(emmeans)    # multiple pairwise comparisons
library(multcomp)   # multiple pairwise comparisons
library(brglm)      # logistic regression with Firth bias-reduction (when dealing with quasi-complete separation)
library(brms)       # Bayesian mixed effects model
library(tidybayes)  # Bayes factor

library(tidyverse)  # tidying and wrangling data, visualizations
library(ggthemes)   # visualization themes for ggplot2
library(corrplot)   # correlation plots


```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r vis-theme}
# Set visualization theme
theme_set(
  ggthemes::theme_few() +
  theme(text = element_text(size = 16)) # large text size for presentation figures
)

condition_colors = c("internalist_biological" = "#49808C",
                     "Internalist (biological)" = "#49808C",
                     "internalist_cultural" = "#F2BF80",
                     "Internalist (cultural)" = "#F2BF80",
                     "structural" = "#D9695F",
                     "Structural" = "#D9695F")

intervention_colors = c("modify Zarpies biology" = "#49808C",
                        "modify Zarpies beliefs/culture" = "#F2BF80",
                        "acquire okinberries" = "#D9695F",
                        "modify okinberries" = "#D9BAB7",
                        "acquire pogoberries" = "#C3C7B6",
                        "other" = "#D9D9D9",
                        "ambiguous" = "#D9D9D9",
                        "don't know" = "#9E9E9E")
```


# Methods
We report how we determined our sample size, all data exclusions (if any), all manipulations, and all measures in the study. <!-- 21-word solution (Simmons, Nelson & Simonsohn, 2012; retrieved from http://ssrn.com/abstract=2160588) --> 

This project's [repository](https://github.com/mariannazhang/structural-consequences) and [preregistration](https://osf.io/hz76n/) can be found online.


```{r predictions-simulation-plots, eval=FALSE, include=FALSE}

# Simulation, given children's predicted responses
sample_size = 150
condition_size = sample_size/3

# Possibility of change & normativity
predicted <- tibble(
  # Set up table
  condition = rep(c("Internalist (biological)", "Internalist (cultural)", "Structural"), each = condition_size * 2), #*3 because 3 measures
  measure = rep(c("Possibility of change", "Normativity"), each = condition_size, times = 3), #*3 conditions
  participant = c(rep(seq(from = 1, to = condition_size, by = 1), times = 2),
                  rep(seq(from = condition_size + 1, to = condition_size*2, by = 1), times = 2),
                  rep(seq(from = condition_size*2 + 1, to = condition_size*3, by = 1), times = 2)),
  
  
  # Simulate responses
  response = 
    c(#Internalist (biological): Possibility of change
      sample(c(1, 2, 3, 4), # response options
             size = condition_size,
             replace = TRUE,
             prob = c(0.4, 0.4, 0.2, 0.1)), # weighted mean = 2.2 of 1-4
      #Internalist (biological): Normativity
      sample(c(1, 2, 3, 4, 5, 6), 
             size = condition_size, 
             replace = TRUE,
             prob = c(0.05, 0.1, 0.15, 0.2, 0.3, 0.2)), # weighted mean = 4.2 of 1-6
      
      
      #Internalist (cultural): Possibility of change
      sample(c(1, 2, 3, 4), 
             size = condition_size, 
             replace = TRUE,
             prob = c(0.2, 0.4, 0.25, 0.15)), # weighted mean = 
      #Internalist (cultural): Normativity
      sample(c(1, 2, 3, 4, 5, 6), 
             size = condition_size, 
             replace = TRUE,
             prob = c(0.05, 0.1, 0.15, 0.25, 0.3, 0.15)), # weighted mean = 4.1 of 1-6
      
      #Structural: Possibility of change
      sample(c(1, 2, 3, 4), 
             size = condition_size, 
             replace = TRUE,
             prob = c(0.1, 0.2, 0.4, 0.3)), # weighted mean = 2.9 of 1-4
      #Structural: Normativity
      sample(c(1, 2, 3, 4, 5, 6), 
             size = condition_size, 
             replace = TRUE,
             prob = c(0.1, 0.3, 0.25, 0.2, 0.1, 0.05)))
)

# Target of intervention
predicted_intervention <- tibble(
  # Set up table
  condition = rep(c("Internalist (biological)", "Internalist (cultural)", "Structural"), each = condition_size * 1), #*3 because 3 measures
  measure = rep(c("Target of intervention"), each = condition_size, times = 3), #*3 conditions
  participant = c(rep(seq(from = 1, to = condition_size, by = 1), times = 1),
                  rep(seq(from = condition_size + 1, to = condition_size*2, by = 1), times = 1),
                  rep(seq(from = condition_size*2 + 1, to = condition_size*3, by = 1), times = 1)),
  
  
  # Simulate responses
  response = 
    c(#Internalist (biological): Target of intervention
      sample(c("modify Zarpies biology", "modify Zarpies beliefs/culture", "acquire okinberries", "other"), 
             size = condition_size, 
             replace = TRUE,
             prob = c(0.6, 0.2, 0.1, 0.1)), 
      #Internalist (cultural): Target of intervention
      sample(c("modify Zarpies biology", "modify Zarpies beliefs/culture", "acquire okinberries", "other"), 
             size = condition_size, 
             replace = TRUE,
             prob = c(0.2, 0.6, 0.1, 0.1)), 
      #Structural: Target of intervention
      sample(c("modify Zarpies biology", "modify Zarpies beliefs/culture", "acquire okinberries", "other"), 
             size = condition_size, 
             replace = TRUE,
             prob = c(0.1, 0.1, 0.7, 0.1))) 
  
)
predicted_intervention$response <- predicted_intervention$response %>% 
  factor(levels = c("modify Zarpies biology", "modify Zarpies beliefs/culture", "acquire okinberries", "other"))

# Summarize simulated responses
predicted_summary <- predicted %>% 
  group_by(condition, measure) %>% 
  summarize(avg = mean(response, na.rm = TRUE),
            sd = sd(response, na.rm = TRUE), 
            n = length(unique(participant)))

predicted_intervention_summary <- predicted_intervention %>% 
  group_by(condition, measure) %>% 
  count(response)


# Plot: possibility of change
ggplot(predicted %>% filter(measure == "Possibility of change"), aes(x = condition, y = response)) +
  ggtitle("Possibility of change: predictions") +
  scale_y_continuous(name = "Can Zarpies also eat okinberries?",
                     limits = c(1, 4),
                     # breaks = c(1, 2, 3, 4),
                     labels = c("For sure no: 1", "Maybe no: 2", "Maybe yes: 3", "For sure yes: 4")) +
  geom_hline(yintercept = mean(c(1, 2, 3, 4)), linetype = "dashed") +
  # geom_point(position = position_jitter(width = 0.2, height = 0.05),
  #            size = 2, alpha = 0.1) +
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               color = "gray",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "gray",
               size = 5) 
ggsave("predicted_possibility_change.png")

# Plot: normativity
ggplot(predicted %>% filter(measure == "Normativity"), aes(x = condition, y = response)) +
  ggtitle("Normativity (6-point): predictions") +
    scale_y_continuous(name = "â€¦for this Zarpie to eat okinberries?",
                       limits = c(1, 6),
                       breaks = c(1, 2, 3, 4, 5, 6),
                       labels = c("Very, very good: 1", "Pretty good: 2", "A little good: 3", "A little bad: 4", "Pretty bad: 5", "Very, very bad: 6")) +
  geom_hline(yintercept = mean(c(1, 2, 3, 4, 5, 6)), linetype = "dashed") +
  # geom_point(position = position_jitter(width = 0.2, height = 0.05),
  #            size = 2, alpha = 0.1) +
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               color = "gray",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "gray",
               size = 5) 
ggsave("predicted_normativity.png")


# Plot: target of intervention
ggplot(predicted_intervention, 
       aes(x = condition, fill = response)) +
  geom_bar(position = "fill", alpha = 0.7) +
  guides(fill = guide_legend(title = NULL)) +
  scale_y_continuous(name = "What would you do, so that \n Zarpies can eat okinberies?",
                     labels = scales::percent) +
  scale_fill_manual(values = intervention_colors) + 
  ggtitle("Target of intervention: predictions") 
ggsave("predicted_intervention.png", width = 10)


```


## Participants

```{r import-data}
# Import pilot data for analysis
data <- read_csv(here("data", "structural-consequences_data_pilot1_coded.csv"))
```

```{r clean-data}
# Filter out those who didn't consent
data <- data %>%
  filter(consent == "I do consent to participate") %>% 
  dplyr::select(-consent)

# Add participant ID
data <- data %>% 
  mutate(participant = row_number())


# Coalesce redundant columns
data <- data %>% 
  mutate(normativity = coalesce(normativity_notOkay, normativity_okay))

# Keep columns we care about
data <- data %>% 
  select(participant, 
         condition, 
         calibrate_poss_1:normativity_fc,
         normativity,
         intervention_coded:ses
         ) 

# Remove line breaks in responses
data$check_group_berry <- data$check_group_berry %>% 
  str_replace_all("\n", "")
```

```{r exclude}
# Record exclusions (participants may be counted twice)
excl <- data %>% 
  summarize(check_group_berry = sum(check_group_berry != "Vawns"),
            check_group = sum(check_group != "Zarpies,Vawns"),
            check_berry = sum(check_berry != "Pogoberries,Okinberries"), 
            check_task = sum(check_task != "Learning about Zarpies and answering questions about them"),
            total_collect = n())

# Exclude participants and remove exclusion columns
data <- data %>%
  filter(check_group_berry == "Vawns" &
           check_group == "Zarpies,Vawns" &
           check_berry == "Pogoberries,Okinberries" &
           check_task == "Learning about Zarpies and answering questions about them") %>% 
  select(-starts_with("check"))
```

```{r sample-size}
# Record number of participants in actual sample after exclusions
n.adults <- data %>% 
  nrow()

# Calculate exclusion rate
excl <- excl %>% 
  mutate(total_excl = total_collect - n.adults,
         excl_rate = total_excl/total_collect)

# Record number of participants in actual sample per condition
n.adults.condition <- data %>% 
  group_by(condition) %>% 
  summarize(n = length(unique(participant)))
```

```{r dem}
# Record demographics of actual sample
## Age
data$age <- data$age %>% 
  as.numeric()
dem.age <- data %>%
  count(age)

## Gender
dem.gender <- data %>%
  count(gender)

## Race
dem.race <- data %>%
  count(race)

## Education
data$education <- data$education %>% 
  factor(levels = c("Less than high school",
                    "High school/GED",
                    "Some college",
                    "Bachelor's (B.A., B.S.)",
                    "Master's (M.A., M.S.)",
                    "Doctoral (Ph.D., J.D., M.D.)",
                    "Prefer not to specify"))
dem.education <- data %>%
  count(education)

## Socio-economic status (SES) #fixme: Qualtrics renamed labels
data$ses <- data$ses %>% 
  factor(levels = c("Poor",
                    "Working class",
                    "Middle class",
                    "Affluent",
                    "Prefer not to specify"))
dem.ses <- data %>%
  count(ses)

```

## Material

## Procedure

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses. 

Participants were excluded for failing the attention checks.
<!-- data cleaning rules, data exclusion rules, covariates, etc. Key analysis of interest. Can also pre-specify additional analyses you plan to do.-->

For the target of intervention question, explanations will be coded into "Internal", "Structural", or "Other" by individuals blind to the research hypothesis. For the purposes of this pilot with adults, explanations will be coded by the experimenter without knowledge of each participant's condition. A fuller coding scheme will be developed before actual testing, but:

- modify Zarpies biology (vaccine, potion, pill, medicine, build tolerance, cross-breed with another alien)
- modify Zarpies beliefs/culture (tell them it's not bad luck, tell them it's good luck, change their thoughts)
- modify okinberries themselves so they are safe to eat (change color, wash them, heat up, cook them, prepare them, remove part, mix with something else, sanitize)
- acquire pogoberries
- acquire okinberries (grow/plant, import, trade, ask Vawns to send, search planet, tell them where to find, share with Vawns, travel, visit Vawns, move to other side of planet, switch spots with Vawns)
- I don't know
- ambiguous (do a magic spell that allows them to eat okinberries, give seeds, ask someone for them, be friendly with others, make it to where the okinberries don't make the Zarpies sick, have it not be poisonous, Will harvest again and cultivate it, establish hospitals for Zarpies when they get sick)
- other (Zarpies will try to eat okinberies, too far away)



- "Internal" = explanations appealing to causes located inside of an individual category member (eg genes, mental states) or inside of the group as a whole (eg culture, shared knowledge)
- "Structural" = explanations appealing to causes located external to the group that operate on the group as a whole (eg location)
- "Other" = idiosyncratic, non-answers, or explanations that appeal to external factors that do not apply to the group as a whole 

```{r recode-tidy}
# Keep columns we care about
data <- data %>% 
  select(participant, 
         condition, 
         possibility_change,
         normativity_fc,
         normativity,
         intervention_coded,
         intervention_diff) 

# condition as factor
data$condition <- data$condition %>% 
  factor(levels = c("internalist_biological", "internalist_cultural", "structural"))

# Recode dependent measures into numerical values
data$possibility_change <- 
  dplyr::recode(data$possibility_change,
         "For sure no" = 1,
         "Maybe no" = 2,
         "Maybe yes" = 3,
         "For sure yes" = 4)

data$normativity_fc_coded <- 
  dplyr::recode(data$normativity_fc,
         "Not okay" = 0,
         "Okay" = 1)

data$normativity <- 
  dplyr::recode(data$normativity,
         "Very, very good" = 1,
         "Pretty good" = 2,
         "A little good" = 3,
         "A little bad" = 4,
         "Pretty bad" = 5,
         "Very, very bad" = 6)

data$intervention_diff <- 
  dplyr::recode(data$intervention_diff,
         "Very easy" = 1,
         "Somewhat easy" = 2,
         "Somewhat difficult" = 3,
         "Very difficult" = 4)
```

```{r}
# Gather long data to tidy form, and rename
data.tidy <- data %>% 
  gather(measure, response, c("possibility_change", "normativity_fc", "normativity_fc_coded", "normativity", "intervention_coded", "intervention_diff"))

data.tidy$condition <- data.tidy$condition %>% 
  dplyr::recode("internalist_biological" = "Internalist (biological)",
         "internalist_cultural" = "Internalist (cultural)",
         "structural" = "Structural")

data.tidy$measure <- data.tidy$measure %>% 
  factor(levels = c("possibility_change", "normativity_fc", "normativity_fc_coded", "normativity", "intervention_coded", "intervention_diff"))
```

```{r}
# Dummy variables for target of intervention codes
data.intervention <- data

data.intervention$intervention_coded <- data.intervention$intervention_coded %>% 
  str_replace_all(" ", "_") %>% 
  str_replace_all("/", "_") %>% 
  str_replace_all("'", "") 

data.intervention <- data.intervention %>% 
  mutate(counts = 1) %>%
  spread(intervention_coded, counts, fill = 0)


# Split out open-ended text responses into separate data tables
data.tidy.intervention <- data.tidy %>%
  filter(measure == "intervention_coded" | measure == "intervention_diff") %>%
  spread(measure, response)
data.tidy <- data.tidy %>%
  filter(measure != "intervention_coded")

data.tidy.intervention$intervention_coded <- data.tidy.intervention$intervention_coded %>%
  factor(levels = c("modify Zarpies biology",
                    "modify Zarpies beliefs/culture",
                    "acquire okinberries",
                    "modify okinberries",
                    "acquire pogoberries",
                    "ambiguous",
                    "other",
                    "don't know"))
data.tidy.intervention$intervention_diff <- data.tidy.intervention$intervention_diff %>%
  as.numeric()


data.tidy.normativity_fc <- data.tidy %>% 
  filter(measure == "normativity_fc")
data.tidy <- data.tidy %>% 
  filter(measure != "normativity_fc")

data.tidy.normativity_fc$response <- data.tidy.normativity_fc$response %>% 
  factor(levels = c("Okay",
                    "Not okay"))

data.tidy$response <- data.tidy$response %>% 
  as.numeric()
```

# Results
## Tables
```{r description}
# calculate means and sds by condition
summary.stats <- data %>% 
  group_by(condition) %>% 
  summarize(possibility_change_mean = mean(possibility_change, na.rm = TRUE),
            possibility_change_sd = sd(possibility_change, na.rm = TRUE),
            normativity_mean = mean(normativity, na.rm = TRUE),
            normativity_sd = sd(normativity, na.rm = TRUE))
summary.stats


# make contingency table of intervention responses
data.intervention.counts <- data.intervention %>% 
  group_by(condition) %>% 
  summarize(modify_Zarpies_biology = sum(modify_Zarpies_biology),
            modify_Zarpies_beliefs_culture = sum(modify_Zarpies_beliefs_culture),
            acquire_okinberries = sum(acquire_okinberries),
            modify_okinberries = sum(modify_okinberries),
            acquire_pogoberries = sum(acquire_pogoberries),
            ambiguous = sum(ambiguous),
            dont_know = sum(dont_know))

```

## Plots
### Possibility of change
```{r description-visualization}
# Plot responses: possibility of change
ggplot(data.tidy %>% filter(measure == "possibility_change"), 
       aes(x = condition, y = response)) +
  ggtitle("Possibility of change") +
  scale_y_continuous(name = "Can Zarpies also eat okinberries?",
                     breaks = c(1, 2, 3, 4),
                     labels = c("For sure no: 1", "Maybe no: 2", "Maybe yes: 3", "For sure yes: 4")) + 
  geom_hline(yintercept = mean(c(1, 2, 3, 4)), linetype = "dashed") +
  geom_point(position = position_jitter(width = 0.2, height = 0.05),
             size = 2, alpha = 0.1) + 
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5) 
ggsave("possibility_change.png", width = 7)
```

### Normativity
```{r}
# Plot: normativity (force choice)
ggplot(data.tidy.normativity_fc, 
       aes(x = condition, fill = response)) +
  geom_bar(position = "fill") +
  geom_hline(yintercept = mean(c(0, 1)), linetype = "dashed") +
  guides(fill = guide_legend(title = "Response")) +
  scale_fill_brewer(type = "div", direction = -1) +
  scale_y_continuous(name = "Attitude towards non-conformity",
                     labels = scales::percent) +
  ggtitle("Normativity (forced choice)") 
ggsave("normativity_fc.png", width = 8)


# Plot responses: normativity
ggplot(data.tidy %>% filter(measure == "normativity"), 
       aes(x = condition, y = response)) +
  ggtitle("Normativity") +
  scale_y_continuous(name = "Attitude towards non-conformity",
                     breaks = c(1, 2, 3, 4, 5, 6),
                     labels = c("Very, very good: 1", "Pretty good: 2", "A little good: 3", "A little bad: 4", "Pretty bad: 5", "Very, very bad: 6")) +
  geom_hline(yintercept = mean(c(1, 2, 3, 4, 5, 6)), linetype = "dashed") +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.1) + 
  stat_summary(fun.data = "mean_cl_boot",
               position = position_dodge(width = 0.8),
               geom = "linerange",
               size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5)
ggsave("normativity.png", width = 8)
```

### Target of intervention and difficulty of intervention
```{r}
# Plot: target of intervention
ggplot(data.tidy.intervention, 
       aes(x = condition, fill = intervention_coded)) +
  geom_bar(position = "fill") +
  guides(fill = guide_legend(title = NULL)) +
  scale_y_continuous(name = "What would you do, so that \n Zarpies can eat okinberies?",
                     labels = scales::percent) +
  scale_fill_manual(values = intervention_colors) + 
  ggtitle("Target of intervention") 
ggsave("intervention.png", width = 10)



# Plot: difficulty of intervention by condition
ggplot(data.tidy.intervention, 
       aes(x = condition, y = intervention_diff, color = intervention_coded)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.1) +
  # stat_summary(fun.data = "mean_cl_boot",
  #              position = position_dodge(width = 0.8),
  #              geom = "linerange",
  #              size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5) +
  guides(fill = guide_legend(title = NULL)) +
  scale_y_continuous(name = "How difficult would it be?",
                     labels = c("Very easy: 1", "Somewhat easy: 2", "Somewhat difficult: 3", "Very difficult: 4")) +
  ggtitle("Difficulty of intervention by condition") 
ggsave("intervention_diff_condition.png", width = 10)


# Plot: difficulty of intervention by intervention type
ggplot(data.tidy.intervention, 
       aes(x = intervention_coded, y = intervention_diff, color = condition)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.3) +
  # stat_summary(fun.data = "mean_cl_boot",
  #              position = position_dodge(width = 0.8),
  #              geom = "linerange",
  #              size = 1) +
  stat_summary(fun = "mean",
               position = position_dodge(width = 0.8),
               geom = "point",
               shape = 21,
               color = "black",
               fill = "black",
               size = 5) +
  scale_color_manual(values = condition_colors) +
  scale_x_discrete(name = "Target of intervention") +
  scale_y_continuous(name = "How difficult would it be?",
                     labels = c("Very easy: 1", "Somewhat easy: 2", "Somewhat difficult: 3", "Very difficult: 4")) +
  ggtitle("Difficulty of intervention by target of intervention") 
ggsave("intervention_diff.png", width = 18)
```

## Models
### Possibility of change
```{r target-analysis-possibility-change}
# Possibility of change: linear model, controlling for difficulty of intervention
possibility_change_lm <- lm(possibility_change ~ condition + intervention_diff,
                            data = data)

# main effect of condition, controlling for intervention difficulty
possibility_change_lm %>% 
  aov() %>% 
  summary()

# compare all pairwise condition means (controlling for difficulty of intervention), FDR adjustment for all comparisons
possibility_change_lm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "fdr") %>% 
  summary()
```


```{r}
# Possibility of change: Bayesian linear model, controlling for difficulty of intervention
possibility_change_brm <- brm(possibility_change ~ condition + intervention_diff,
                              data = data,
                              file = "possibility_change_brm")
possibility_change_brm %>% 
  pp_check() # posterior predictive check looks weird because possibility_change is actually ordinal, not continuous?

possibility_change_brm %>% 
  hypothesis("conditionstructural > 0") # Structural vs Internalist (biological)

possibility_change_brm %>% 
  hypothesis("conditionstructural - conditioninternalist_cultural > 0") # Structural vs Internalist (cultural)

possibility_change_brm %>% 
  hypothesis("conditioninternalist_cultural > 0") # Internalist (cultural) vs Internalist (biological)
```

### Normativity
```{r target-analysis-normativity}
# Normativity: linear model, controlling for difficulty of intervention
normativity_lm <- lm(normativity ~ condition + intervention_diff,
                     data = data)

# main effect of condition, controlling for intervention difficulty
normativity_lm %>% 
  aov() %>% 
  summary()

# compare all pairwise condition means (controlling for difficulty of intervention), FDR adjustment for all comparisons
normativity_lm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "fdr") %>% 
  summary()
```

```{r}
# Normativity: Bayesian linear model, controlling for difficulty of intervention
normativity_brm <- brm(normativity ~ condition + intervention_diff,
                       data = data,
                       file = "normativity_brm")

normativity_brm %>% 
  pp_check() # posterior predictive check looks weird because measure is actually ordinal, not continuous?

normativity_brm %>% 
  hypothesis("conditionstructural > 0") # Structural vs Internalist (biological)

normativity_brm %>% 
  hypothesis("conditionstructural - conditioninternalist_cultural > 0") # Structural vs Internalist (cultural)

normativity_brm %>% 
  hypothesis("conditioninternalist_cultural > 0") # Internalist (cultural) vs Internalist (biological)
```

### Target of intervention
Analyze whether counts of coded responses are independent of condition, using Fisher's exact test (rather than chi-square because of small sample size).
```{r}
# Fisher's exact test: are the proportion of responses different across the 3 conditions?
fisher.test(data.intervention.counts %>% 
              dplyr::select(-condition), workspace = 2e8)
```

#### Modify Zarpies biology
```{r intervention-modify-Zarpies-biology-glm}
# Target of intervention: modify Zarpies biology: logistic regression, controlling for difficulty of intervention 
glm(modify_Zarpies_biology ~ condition + intervention_diff,
    family = "binomial",
    data = data.intervention) %>% 
  summary()
```
Observed quasi-complete separation in the logistic regression for the internalist_cultural condition, so implemented logistic regression with Firth bias-reduction. 

```{r intervention-modify-Zarpies-biology-brglm, warning=FALSE}
modify_Zarpies_biology_brglm <- brglm(modify_Zarpies_biology ~ condition + intervention_diff,
    family = "binomial",
    data = data.intervention)

# ANOVA for main effect of condition, controlling for intervention difficulty? --> yes
modify_Zarpies_biology_brglm %>%
  aov() %>%
  summary()

# simultaneous pairwise comparisons (condition 1v2, 2v3, 1v3), adjusted --> biological > cultural/structural
modify_Zarpies_biology_brglm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "FDR") %>% 
  summary()

# planned contrasts (biological vs cultural/structural, then cultural vs structural), adjusted --> biological > cultural/structural
contrast(emmeans(modify_Zarpies_biology_brglm, "condition"),
         list(biological_vs_other = c(1, -0.5, -0.5),
              cultural_vs_structural = c(0, 1, -1)),
         adjust = "FDR")

# more than half in biological condition? --> no
binom.test(x = data.intervention %>% filter(condition == "internalist_biological") %>% pull(modify_Zarpies_biology) %>% sum(),
           n = data.intervention %>% filter(condition == "internalist_biological") %>% pull(modify_Zarpies_biology) %>% length(),
           p = 0.5, # compare against half
           alternative = "two.sided")
```

```{r}
# Target of intervention: modify Zarpies biology: Bayesian logistic regression, controlling for difficulty of intervention
modify_Zarpies_biology_brm <- brm(modify_Zarpies_biology ~ condition + intervention_diff,
    family = "binomial",
    data = data.intervention,
    file = "modify_Zarpies_biology_brm")

modify_Zarpies_biology_brm %>% 
  pp_check() 

modify_Zarpies_biology_brm %>% 
  hypothesis("conditionstructural < 0") # Structural vs Internalist (biological)

modify_Zarpies_biology_brm %>% 
  hypothesis("conditionstructural - conditioninternalist_cultural < 0") # Structural vs Internalist (cultural)

modify_Zarpies_biology_brm %>% 
  hypothesis("conditioninternalist_cultural < 0") # Internalist (cultural) vs Internalist (biological)
```

#### Modify Zarpies beliefs/culture
```{r}
# Target of intervention: modify Zarpies beliefs/culture: logistic regression, controlling for difficulty of intervention 
glm(modify_Zarpies_beliefs_culture ~ condition + intervention_diff,
    family = "binomial",
    data = data.intervention) %>% 
  summary()
```
Observed quasi-complete separation in the logistic regression for the internalist_cultural condition, so implemented logistic regression with Firth bias-reduction. 

```{r intervention-modify-Zarpies-beliefs-culture-brglm, warning=FALSE}
modify_Zarpies_beliefs_culture <- brglm(modify_Zarpies_beliefs_culture ~ condition + intervention_diff,
    family = "binomial",
    data = data.intervention)

# main effect of condition, controlling for intervention difficulty? (ANOVA)
modify_Zarpies_beliefs_culture %>%
  aov() %>%
  summary()

# simultaneous pairwise comparisons (condition 1v2, 2v3, 1v3), adjusted
modify_Zarpies_beliefs_culture %>% 
  emmeans("condition") %>% 
  pairs(adjust = "FDR") %>% 
  summary()

# planned contrasts (cultural vs biological/structural, then biological vs structural), adjusted
contrast(emmeans(modify_Zarpies_beliefs_culture, "condition"),
         list(cultural_vs_other = c(-0.5, 1, -0.5),
              biological_vs_structural = c(-1, 0, 1)),
         adjust = "FDR")

# more than half in cultural condition? --> no
binom.test(x = data.intervention %>% filter(condition == "internalist_cultural") %>% pull(modify_Zarpies_beliefs_culture) %>% sum(),
           n = data.intervention %>% filter(condition == "internalist_cultural") %>% pull(modify_Zarpies_beliefs_culture) %>% length(),
           p = 0.5, # compare against half
           alternative = "two.sided")
```

```{r}
# Target of intervention: modify Zarpies beliefs/culture: Bayesian logistic regression, controlling for difficulty of intervention
modify_Zarpies_beliefs_culture_brm <- brm(modify_Zarpies_beliefs_culture ~ condition + intervention_diff,
    family = "binomial",
    data = data.intervention,
    file = "modify_Zarpies_beliefs_culture_brm")

modify_Zarpies_beliefs_culture_brm %>% 
  pp_check() 

modify_Zarpies_beliefs_culture_brm %>% 
  hypothesis("conditionstructural > 0") # Structural vs Internalist (biological)

modify_Zarpies_beliefs_culture_brm %>% 
  hypothesis("conditionstructural - conditioninternalist_cultural < 0") # Structural vs Internalist (cultural)

modify_Zarpies_beliefs_culture_brm %>% 
  hypothesis("conditioninternalist_cultural > 0") # Internalist (cultural) vs Internalist (biological)
```

#### Acquire okinberries
```{r intervention-acquire-okinberries-brglm, warning=FALSE}
# Target of intervention: acquire okinberies: logistic regression, controlling for difficulty of intervention
acquire_okinberries_glm <- glm(acquire_okinberries ~ condition + intervention_diff,
    family = "binomial",
    data = data.intervention)
```

glm actually looks okay for acquire okinberries, so we proceed

```{r}
# main effect of condition, controlling for intervention difficulty? (ANOVA)
acquire_okinberries_glm %>%
  aov() %>%
  summary()

# simultaneous pairwise comparisons (condition 1v2, 2v3, 1v3), adjusted
acquire_okinberries_glm %>% 
  emmeans("condition") %>% 
  pairs(adjust = "fdr") %>% 
  summary()

# planned contrasts (structural vs cultural/structural, then biological vs cultural), adjusted
contrast(emmeans(acquire_okinberries_glm, "condition"),
         list(structural_vs_other = c(-0.5, -0.5, 1),
              biological_vs_structural = c(-1, 1, 0)),
         adjust = "FDR")

# more than half in structural condition? 
binom.test(x = data.intervention %>% filter(condition == "structural") %>% pull(acquire_okinberries) %>% sum(),
           n = data.intervention %>% filter(condition == "structural") %>% pull(acquire_okinberries) %>% length(),
           p = 0.5, # compare against half
           alternative = "two.sided")
```

```{r}
# Target of intervention: acquire okinberries: Bayesian logistic regression, controlling for difficulty of intervention
acquire_okinberries_brm <- brm(modify_Zarpies_beliefs_culture ~ condition + intervention_diff,
    family = "binomial",
    data = data.intervention,
    file = "acquire_okinberries_brm")

acquire_okinberries_brm %>% 
  pp_check() 

acquire_okinberries_brm %>% 
  hypothesis("conditionstructural > 0") # Structural vs Internalist (biological)

acquire_okinberries_brm %>% 
  hypothesis("conditionstructural - conditioninternalist_cultural > 0") # Structural vs Internalist (cultural)

acquire_okinberries_brm %>% 
  hypothesis("conditioninternalist_cultural > 0") # Internalist (cultural) vs Internalist (biological)
```

# Exploratory analysis

## Correlations between measures
```{r exploratory-analysis-all}
# Overall correlations between measures
cor_measures <- cor(data %>% select(possibility_change, normativity, intervention_diff))

cor_measures_sig <- cor.mtest(data %>% select(possibility_change, normativity, intervention_diff), 
                          conf.level = 0.95)

png(height=600, width=600, file="cor_measures.png")
corrplot.mixed(cor_measures, 
               tl.col = "black",
               tl.srt = 45,
               p.mat = cor_measures_sig$p, 
               sig.level = c(0.001, 0.01, 0.05),
               insig = "label_sig",
               pch.cex = 0.9,
               pch.col = "white")
dev.off()
```

## Possibility of change and intervention difficulty
```{r exploratory-analysis-possibility_change-intervention_diff}
# Possibility of change and intervention difficulty
## Plot: intervention difficulty by possibility of change
ggplot(data, 
       aes(x = possibility_change, y = intervention_diff)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE, level = 0.95) +
  scale_x_continuous(name = "Possibility of change",
                   breaks = c(1, 2, 3, 4),
                   labels = c("For sure no: 1", "Maybe no: 2", "Maybe yes: 3", "For sure yes: 4")) +
  scale_y_continuous(name = "Difficulty of suggested intervention",
                   breaks = c(1, 2, 3, 4),
                   labels = c("Very easy: 1", "Somewhat easy: 2", "Somewhat difficult: 3", "Very difficult: 4"))
ggsave("intervention_diff_possibility_change.png", width = 8)

ggplot(data, 
       aes(x = possibility_change, y = intervention_diff, color = condition)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE, level = 0.95) +
  scale_color_manual(values = condition_colors) +
  scale_x_continuous(name = "Possibility of change",
                   breaks = c(1, 2, 3, 4),
                   labels = c("For sure no: 1", "Maybe no: 2", "Maybe yes: 3", "For sure yes: 4")) +
  scale_y_continuous(name = "Difficulty of suggested intervention",
                     breaks = c(1, 2, 3, 4),
                     labels = c("Very easy: 1", "Somewhat easy: 2", "Somewhat difficult: 3", "Very difficult: 4"))
ggsave("intervention_diff_possibility_change_condition.png", width = 10)

## Spearman correlation, Kendall correlation (for 2 interval variables)
cor.test(data$possibility_change, data$intervention_diff,  method = "spearman")
cor.test(data$possibility_change, data$intervention_diff,  method = "kendall")
```

## Normativity and possibility of change
```{r exploratory-analysis-possibility_change-normativity}
## Plot: normativity by possibility of change
ggplot(data, 
       aes(x = possibility_change, y = normativity)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE, level = 0.95) +
  scale_x_continuous(name = "Possibility of change",
                   breaks = c(1, 2, 3, 4),
                   labels = c("For sure no: 1", "Maybe no: 2", "Maybe yes: 3", "For sure yes: 4")) +
  scale_y_continuous(name = "Normativity",
                     breaks = c(1, 2, 3, 4, 5, 6),
                     labels = c("Very, very good: 1", "Pretty good: 2", "A little good: 3", "A little bad: 4", "Pretty bad: 5", "Very, very bad: 6"))
ggsave("normativity_possibility_change.png", width = 8)

ggplot(data, 
       aes(x = possibility_change, y = normativity, color = condition)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE, level = 0.95) +
  scale_color_manual(values = condition_colors) +
  scale_x_continuous(name = "Possibility of change",
                   breaks = c(1, 2, 3, 4),
                   labels = c("For sure no: 1", "Maybe no: 2", "Maybe yes: 3", "For sure yes: 4")) +
  scale_y_continuous(name = "Normativity",
                     breaks = c(1, 2, 3, 4, 5, 6),
                     labels = c("Very, very good: 1", "Pretty good: 2", "A little good: 3", "A little bad: 4", "Pretty bad: 5", "Very, very bad: 6"))
ggsave("normativity_possibility_change_condition.png", width = 10)


## Spearman correlation, Kendall correlation (for 2 interval variables)
cor.test(data$possibility_change, data$normativity,  method = "spearman")
cor.test(data$possibility_change, data$normativity,  method = "kendall")

```

## Intervention difficulty by normativity
```{r exploratory-analysis-normativity_intervention-diff}
## Plot: intervention difficulty by normativity
ggplot(data, 
       aes(x = normativity, y = intervention_diff)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE, level = 0.95) +
  scale_x_continuous(name = "Normativity",
                     breaks = c(1, 2, 3, 4, 5, 6),
                     labels = c("Very, very good: 1", "Pretty good: 2", "A little good: 3", "A little bad: 4", "Pretty bad: 5", "Very, very bad: 6")) +
  scale_y_continuous(name = "Difficulty of suggested intervention",
                     breaks = c(1, 2, 3, 4),
                     labels = c("Very easy: 1", "Somewhat easy: 2", "Somewhat difficult: 3", "Very difficult: 4"))
ggsave("intervention_diff_normativity.png", width = 8)

ggplot(data, 
       aes(x = normativity, y = intervention_diff, color = condition)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.075),
             size = 2, alpha = 0.3) +
  geom_smooth(method = "lm", se = TRUE, level = 0.95) +
  scale_color_manual(values = condition_colors) +
  scale_x_continuous(name = "Normativity",
                     breaks = c(1, 2, 3, 4, 5, 6),
                     labels = c("Very, very good: 1", "Pretty good: 2", "A little good: 3", "A little bad: 4", "Pretty bad: 5", "Very, very bad: 6")) +
  scale_y_continuous(name = "Difficulty of suggested intervention",
                     breaks = c(1, 2, 3, 4),
                     labels = c("Very easy: 1", "Somewhat easy: 2", "Somewhat difficult: 3", "Very difficult: 4"))
ggsave("intervention_diff_normativity_condition.png", width = 10)


## Spearman correlation, Kendall correlation (for 2 interval variables)
cor.test(data$normativity, data$intervention_diff,  method = "spearman")
cor.test(data$normativity, data$intervention_diff,  method = "kendall")

```

# Discussion


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
